---
description: tasks.yaml（Loop C用タスク定義）を作成・修正する
---

# タスク定義ファイル作成・修正（/plan_tasks）

tasks.yaml を作成または修正します。

## tasks.yaml とは

Loop C で順次実行するための **タスク定義** ファイル。
各タスクに具体的な作業指示と検証項目を記載し、自動実行・検証を行う。

## 詳細設計ドキュメントが必要なケース

以下のケースでは tasks.yaml に加えて `doc/design/{feature-name}-design.md` を作成する:

- **アーキテクチャ判断**: 技術選択の根拠（WebSocket vs SSE 等）
- **複雑なデータ構造**: 状態遷移図、ER図、スキーマ定義
- **外部システム連携**: シーケンス図、API仕様、認証フロー
- **UI/UX設計**: ワイヤーフレーム、画面遷移、コンポーネント構成

詳細ドキュメントを作成した場合、tasks.yaml の `instruction` から参照する:

```yaml
- id: task_payment
  name: 決済処理の実装
  instruction: |
    doc/design/payment-design.md のシーケンス図に従って実装する。

    ## 参照
    - doc/design/payment-design.md
```

## モード判定

- **引数なし**: 新規作成モード
- **引数あり**: 既存ファイルの修正モード

---

## 新規作成モード

### 手順

1. **目的・スコープの把握**
   - 指示内容から機能名を抽出
   - 実現したいことの範囲を確認

2. **コードベース調査**（必要に応じて）
   - 関連する既存コード
   - 変更対象ファイルの特定

3. **タスクの分解・設計**
   - 単一責任の原則に従って分解
   - 依存関係の整理
   - 各タスクに検証項目を定義

4. **出力**
   - `doc/design/{feature-name}-tasks.yaml` に保存

### 出力フォーマット

```yaml
# 出力先: doc/design/{feature-name}-tasks.yaml

# 前提条件（タスク開始前に完了しておくべき簡単な準備作業）
# - {ツールのインストール等}: `{コマンド}`
# ※ 数分で完了する作業のみ記載。それ以上かかる場合は独立したタスクにする

tasks:
  - id: task_1
    name: {タスク名}
    depends_on: []
    instruction: |
      {具体的な作業指示}

      ## 変更対象
      - `src/{path/to/file}`: {変更内容}

      ## 関連パス
      - `src/{path/to/related}`: {役割・関係性}
    validation:
      - "{検証項目}"

  - id: task_2
    name: {タスク名}
    depends_on: [task_1]
    instruction: |
      {具体的な作業指示}
    validation:
      - "{検証項目}"
```

---

## 修正モード

### 手順

1. **既存ファイルの読み込み**

2. **問題点の分析**
   - タスクの粒度は適切か
   - 依存関係に矛盾はないか
   - 検証項目は明確か
   - 指示内容は自己完結しているか

3. **改善提案の提示**
   - 問題点と改善案を明示
   - ユーザーに確認

4. **更新**
   - 承認後、ファイルを更新

---

## タスク設計の原則

1. **単一責任**: 1タスク = 1つの明確な成果物

2. **検証可能**: 各タスクに機械的に確認可能な validation を定義

3. **依存関係の明示**: depends_on で順序を制御

4. **自己完結**: 各タスクの instruction は単独で実行可能な情報を含む

5. **セットアップと作業の分離**: ツールのインストール等のセットアップは、それを使う作業と同一タスクにしない
   - 前提条件として記載: 失敗リスクが低く数分で完了するもの
   - 独立タスクにする: 失敗リスクがある、または後続タスクの依存元になるもの
   - 悪い例: 「xenonインストール + complexityチェック」を1タスクに
   - 良い例: task_setup_xenon → task_complexity_check（depends_on: [task_setup_xenon]）

---

## スコープ

このコマンドの責務は **tasks.yaml ファイルの作成・更新のみ**。

後続の実行（`task-orchestrator run`）はユーザーが判断する。
